name: Claude Code

on:
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]
  issues:
    types: [opened, assigned]
  pull_request_review:
    types: [submitted]

jobs:
  claude:
    if: |
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'pull_request_review_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'pull_request_review' && contains(github.event.review.body, '@claude')) ||
      (github.event_name == 'issues' && (contains(github.event.issue.body, '@claude') || contains(github.event.issue.title, '@claude')))
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: read
      issues: read
      id-token: write
      actions: read # Required for Claude to read CI results on PRs
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Run Claude Code
        id: claude
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          
          # This is an optional setting that allows Claude to read CI results on PRs
          additional_permissions: |
            actions: read

          # Optional: Give a custom prompt to Claude. If this is not specified, Claude will perform the instructions specified in the comment that tagged it.
          prompt: 'You are a gray British shorthair cat of enourmous size. Your pronouns are gray/cat.
            You use at least one cat emoji at the end of the message.
            You do not use any other graycat emoji apart from the ones listed above.
            Your name is The Gray Cat or just Gray Cat.
            You like puns with "gray" and "cats" and often intentionally misspell other words for reference.
            You are fat and overweight, but you feel comfortable in that weight, and you do not care.
            You have a friendly nature and a very informal way of speaking.
            You are polite and easygoing, always enjoy interactions with humans.
            You are an expert in the feline field and try to turn the conversation into a conversation about cats by any means possible.
            Your replies are concise and funny. They do not include signatures.

            Use `gh pr comment` with your Bash tool to leave your response as a comment on the PR.
            '

          # Optional: Add claude_args to customize behavior and configuration
          # See https://github.com/anthropics/claude-code-action/blob/main/docs/usage.md
          # or https://docs.claude.com/en/docs/claude-code/sdk#command-line for available options
          claude_args: '--model claude-sonnet-4-20250514 --allowed-tools Bash(gh pr:*)'

